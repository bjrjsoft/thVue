<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="center">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
    <link rel="stylesheet" href="http://localhost/arcgis_js_api/3.18/esri/css/esri.css">

    <link rel="stylesheet" href="../ace/css/bootstrap.css">
    <link rel="stylesheet" href="../ace/css/ace.css">
    <link rel="stylesheet" href="../ace/css/font-awesome.css">
    <link rel="stylesheet" href="../ace/css/jquery-ui.css">
    <link rel="stylesheet" href="../gis/minimal/blue.css" >
    <link rel="stylesheet" href="../ace/css/bootstrap-table.min.css">
    <link rel="stylesheet" href="../ace/css/ace-rtl.css" />
    <link rel="stylesheet" href="../ace/css/ace-skins.css" />
    <!--[if !IE]> -->
    <script src="../ace/components/jquery/jquery.js"></script>
<!-- <![endif]-->
<!--[if IE]>
    <script src="../ace/components/jquery.1x/jquery.js"></script>
<![endif]-->
    <script src="../ace/js/bootstrap.js" type="text/javascript"></script>
    <script src="../echarts/echarts.min.js" type="text/javascript"></script>
    <script src="../echarts/bmapBase.js" type="text/javascript"></script>
    <script src="../echarts/bmap.min.js" type="text/javascript"></script>
    <script src="../gis/icheck.min.js" type="text/javascript"></script>
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script src="../ace/js/ace-extra.js" type="text/javascript"></script>
    <script src="../ace/js/data/fuelux.tree-sampledata.js" type="text/javascript"></script>
    <script src="../ace/js/bootstrap-treeview.min.js" type="text/javascript"></script>
    <script src="../ace/js/fuelux.tree.min.js" type="text/javascript"></script>

    <script src="../ace/js/bootstrap-table.js"></script>
    <script src="../ace/js/bootstrap-table-zh-CN.min.js"></script>
    <script src="http://localhost/arcgis_js_api/3.18/init.js"></script>
    <style>
			html,body{
                    width:100%;
                    height:100%;
            }
		</style>
</head>
<body id="body">
    <div id="mapDiv" style="height:100%;width:100%;">
        <div style="position: absolute; z-index: 80; right: 13px; background-color: none; " class="tl" id="map_right">
            <div class="boder">
                <input type="radio" onchange="rchange('zdxcz')" checked="checked" name="bule" id="zdxcz"/>
                <label for="zdxcz">自动巡测站</label>
                <input type="radio" onchange="rchange('rgxcz')" name="bule" id="rgxcz"/>
                <label for="rgxcz">人工巡测站</label>
            </div>
        </div>
    </div>
    <div id="maptool" style="display:none"></div>
    <script src="../../result/build.js"></script>
</body>
</html>
<script type="text/javascript">
    var test_lz = [
    {
        "ADAG": "太湖流域水环境监测中心",
        "MNAG": "",
        "LGTD": "120.10861",
        "BSNM": "长江",
        "NT": "",
        "STNM": "龚巷桥",
        "WFRCD": "",
        "STLC": "江苏武进雪堰镇龚巷村",
        "WDSTYM": "",
        "ESSTYM": "",
        "WRRCD": "F120100",
        "ADDVCD": "320400",
        "STCD": "50000002",
        "STGRD": "",
        "HNNM": "太湖流域湖区水系",
        "RVNM": "武进港",
        "LTTD": "31.505556",
        "id": "50000002",
        "index": 2
    },
    {
        "ADAG": "太湖流域水环境监测中心",
        "MNAG": "",
        "LGTD": "119.98694",
        "BSNM": "长江",
        "NT": "t1",
        "STNM": "新塘大桥",
        "WFRCD": "",
        "STLC": "浙江长兴雉城镇新塘村",
        "WDSTYM": "",
        "ESSTYM": "",
        "WRRCD": "F120100",
        "ADDVCD": "330400",
        "STCD": "50000003",
        "STGRD": "",
        "HNNM": "太湖流域湖区水系",
        "RVNM": "长兴港",
        "LTTD": "31.034445",
        "id": "50000003",
        "index": 3
    },
    {
        "ADAG": "太湖流域水环境监测中心",
        "MNAG": "",
        "LGTD": "120.01111",
        "BSNM": "长江",
        "NT": "t1",
        "STNM": "杨家浦桥",
        "WFRCD": "",
        "STLC": "浙江省长兴县杨家浦村",
        "WDSTYM": "",
        "ESSTYM": "",
        "WRRCD": "F120100",
        "ADDVCD": "330400",
        "STCD": "50000004",
        "STGRD": "",
        "HNNM": "太湖流域湖区水系",
        "RVNM": "杨家浦港",
        "LTTD": "31.019444",
        "id": "50000004",
        "index": 4
    },
    {
        "ADAG": "水利部太湖流域管理局",
        "MNAG": "",
        "LGTD": "120.12466",
        "BSNM": "长江流域",
        "NT": "t4",
        "STNM": "三里桥",
        "WFRCD": "10024",
        "STLC": "",
        "WDSTYM": "",
        "ESSTYM": "",
        "WRRCD": "F120300",
        "ADDVCD": "330400",
        "STCD": "50000037",
        "STGRD": "",
        "HNNM": "太湖流域苕溪水系",
        "RVNM": "泗安塘",
        "LTTD": "30.85433",
        "id": "50000037",
        "index": 34
    },
    {
        "ADAG": "浙江省水文局",
        "MNAG": "",
        "LGTD": "120.03333",
        "BSNM": "长江",
        "NT": "wq",
        "STNM": "杨家埠",
        "WFRCD": "",
        "STLC": "浙江省湖州市龙溪乡杨家埠",
        "WDSTYM": "",
        "ESSTYM": "",
        "WRRCD": "F120100",
        "ADDVCD": "330400",
        "STCD": "63010800",
        "STGRD": "",
        "HNNM": "太湖流域苕溪水系",
        "RVNM": "旄儿港",
        "LTTD": "30.9",
        "id": "63010800",
        "index": 36
    },
    {
        "ADAG": "水利部太湖流域管理局",
        "MNAG": "",
        "LGTD": "119.576385",
        "BSNM": "长江流域",
        "NT": "wq",
        "STNM": "杨桥",
        "WFRCD": "F1201201004000",
        "STLC": "浙江湖州长兴县",
        "WDSTYM": "",
        "ESSTYM": "",
        "WRRCD": "F120100",
        "ADDVCD": "330400",
        "STCD": "63080010",
        "STGRD": "",
        "HNNM": "太湖流域苕溪水系",
        "RVNM": "泗安水库上游",
        "LTTD": "30.932499",
        "id": "63080010",
        "index": 37
    },
    {
        "ADAG": "水利部太湖流域管理局",
        "MNAG": "",
        "LGTD": "120.18111",
        "BSNM": "长江",
        "NT": "wq",
        "STNM": "大钱闸",
        "WFRCD": "F1203101523013",
        "STLC": "浙江湖州",
        "WDSTYM": "",
        "ESSTYM": "",
        "WRRCD": "F120100",
        "ADDVCD": "330400",
        "STCD": "63080120",
        "STGRD": "",
        "HNNM": "太湖流域苕溪水系",
        "RVNM": "东苕溪",
        "LTTD": "30.925554",
        "id": "63080120",
        "index": 38
    },
    {
        "ADAG": "水利部太湖流域管理局",
        "MNAG": "",
        "LGTD": "119.94",
        "BSNM": "长江",
        "NT": "wq",
        "STNM": "棉堤桥",
        "WFRCD": "F1201103514000",
        "STLC": "江苏宜兴",
        "WDSTYM": "",
        "ESSTYM": "",
        "WRRCD": "F120100",
        "ADDVCD": "320200",
        "STCD": "63180030",
        "STGRD": "",
        "HNNM": "太湖流域南溪水系",
        "RVNM": "烧香港",
        "LTTD": "31.373611",
        "id": "63180030",
        "index": 39
    },
    {
        "ADAG": "水利部太湖流域管理局",
        "MNAG": "",
        "LGTD": "119.9425",
        "BSNM": "长江",
        "NT": "wq",
        "STNM": "社渎港桥",
        "WFRCD": "F1201103714000",
        "STLC": "江苏宜兴",
        "WDSTYM": "",
        "ESSTYM": "",
        "WRRCD": "F120100",
        "ADDVCD": "320200",
        "STCD": "63180040",
        "STGRD": "",
        "HNNM": "太湖流域南溪水系",
        "RVNM": "社渎港",
        "LTTD": "31.35639",
        "id": "63180040",
        "index": 40
    },
    {
        "ADAG": "水利部太湖流域管理局",
        "MNAG": "",
        "LGTD": "119.93083",
        "BSNM": "长江",
        "NT": "wq",
        "STNM": "官渎港桥",
        "WFRCD": "",
        "STLC": "江苏宜兴",
        "WDSTYM": "",
        "ESSTYM": "",
        "WRRCD": "F120100",
        "ADDVCD": "320200",
        "STCD": "63180045",
        "STGRD": "",
        "HNNM": "太湖流域南溪水系",
        "RVNM": "官渎港",
        "LTTD": "31.341112",
        "id": "63180045",
        "index": 41
    },
    {
        "ADAG": "水利部太湖流域管理局",
        "MNAG": "",
        "LGTD": "119.92194",
        "BSNM": "长江",
        "NT": "wq",
        "STNM": "大浦港桥",
        "WFRCD": "F1201101614000",
        "STLC": "江苏宜兴",
        "WDSTYM": "",
        "ESSTYM": "",
        "WRRCD": "F120100",
        "ADDVCD": "320200",
        "STCD": "63180055",
        "STGRD": "",
        "HNNM": "太湖流域南溪水系",
        "RVNM": "大浦港",
        "LTTD": "31.313889",
        "id": "63180055",
        "index": 42
    },
    {
        "ADAG": "江苏省水文水资源勘测局",
        "MNAG": "",
        "LGTD": "119.48555",
        "BSNM": "长江",
        "NT": "wq",
        "STNM": "团结桥",
        "WFRCD": "",
        "STLC": "溧阳市团结桥",
        "WDSTYM": "",
        "ESSTYM": "",
        "WRRCD": "F120100",
        "ADDVCD": "320400",
        "STCD": "63186600",
        "STGRD": "",
        "HNNM": "太湖流域南溪水系",
        "RVNM": "南河",
        "LTTD": "31.42389",
        "id": "63186600",
        "index": 43
    },
    {
        "ADAG": "水利部太湖流域管理局",
        "MNAG": "",
        "LGTD": "120.491104",
        "BSNM": "长江",
        "NT": "wq",
        "STNM": "B25#戗港外",
        "WFRCD": "F1201300211000",
        "STLC": "东太湖水体",
        "WDSTYM": "",
        "ESSTYM": "",
        "WRRCD": "F120100",
        "ADDVCD": "320000",
        "STCD": "63280153",
        "STGRD": "",
        "HNNM": "太湖流域湖区水系",
        "RVNM": "太湖东太湖水体",
        "LTTD": "31.077778",
        "id": "63280153",
        "index": 100
    }
];
    //---
    GisModelConfig = {
    baseInfoLayers:[
      {
         name   : '底图',
         id : 'baseInfo_xzq',
         url : "http://10.1.102.129:6080/arcgis/rest/services/taihu/th_basemap2/MapServer",
         layerType:'',
         useType:'basic',
         visible:true,
         contentType:'Polygon'
      },{
         name   : '太湖分区',
         id : 'baseInfo_xzq1',
         url : "http://10.1.102.129:6080/arcgis/rest/services/taihu/th_partition_blue/MapServer",
         layerType:'',
         useType:'basic',
         visible:true,
         contentType:'Polygon'
      },{
         name   : '人工测站',
         id : 'baseInfo_xzq2',
         url : "http://10.1.102.129:6080/arcgis/rest/services/taihu/th_rgcezhan/MapServer",
         layerType:'',
         visible:false,
         useType:'',
         contentType:'Point'
      },{
         name   : '主要河流',
         id : 'baseInfo_xzq3',
         url : "http://10.1.102.129:6080/arcgis/rest/services/taihu/th_river/MapServer",
         layerType:'',
         visible:false,
         useType:'basic',
         contentType:'Line'
      },{
         name   : '水功能一级区划',
         id : 'baseInfo_xzq4',
         url : "http://10.1.102.129:6080/arcgis/rest/services/taihu/th_sgnyijiquhua/MapServer",
         layerType:'',
         visible:false,
         useType:'basic',
         contentType:'Polygon'
      },{
         name   : '水利分区',
         id : 'baseInfo_xzq5',
         url : "http://10.1.102.129:6080/arcgis/rest/services/taihu/th_shuilifenqu/MapServer",
         layerType:'',
         visible:false,
         useType:'basic',
         contentType:'Polygon'
      },{
         name   : '水质测站',
         id : 'baseInfo_xzq6',
         url : "http://10.1.102.129:6080/arcgis/rest/services/taihu/th_szcezhan/MapServer",
         layerType:'',
         visible:false,
         useType:'',
         contentType:'Point'
      }
    ],
        centerPt:[120.50,31.2],
        xzqUrl : "http://10.1.102.129:6080/arcgis/rest/services/taihu/th_basemap/MapServer"
  };
    require(["esri/symbols/SimpleFillSymbol","esri/graphic","gowa/gisObject","esri/layers/FeatureLayer","esri/layers/GraphicsLayer","esri/toolbars/draw", "esri/geometry/geometryEngine","esri/graphicsUtils","esri/tasks/RelationParameters","esri/symbols/PictureMarkerSymbol",
      "esri/tasks/GeometryService","esri/geometry/Polygon","esri/geometry/Point","dojo/domReady!"],
    function(SimpleFillSymbol,Graphic,gisObject,FeatureLayer,GraphicsLayer,Draw,geometryEngine,graphicsUtils,RelationParameters,PictureMarkerSymbol,GeometryService,Polygon,Point){
        newGisObject = new gisObject(GisModelConfig,'mapDiv',maptest);
        newGisObject.initMap('mapDiv');
});
function maptest(){
    newGisObject.mapObject.setLevel(2);
    addGraphicLayer();
}
function addGraphicLayer(){
    require(["esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/PictureMarkerSymbol",
        "esri/tasks/QueryTask","esri/layers/GraphicsLayer","esri/tasks/FeatureSet","esri/graphic","esri/geometry/Point",
        "dojo/_base/Color","esri/layers/FeatureLayer","esri/tasks/query","esri/config"],
        function(SimpleFillSymbol,SimpleLineSymbol,PictureMarkerSymbol,QueryTask,
            GraphicsLayer,FeatureSet,Graphic,Point,Color,FeatureLayer,Query,esriConfig){

            //浮台站
            graphicsLayer_ft = new GraphicsLayer();
            graphicsLayer_ft.id = "graphicsLayer_ft";
            graphicsLayer_ft.visible = true;
            newGisObject.addNewLayer('Point',graphicsLayer_ft);
            graphicsLayer_ft.on("mouse-over",function(e){
                sztooltip(e,"ft");
            });
            //监视站
            graphicsLayer_js = new GraphicsLayer();
            graphicsLayer_js.id = "graphicsLayer_js";
            graphicsLayer_js.visible = true;
            newGisObject.addNewLayer('Point',graphicsLayer_js);
            graphicsLayer_js.on("mouse-over",function(e){
                sztooltip(e,"js");
            });
            //人工巡测站
            graphicsLayer_rg = new GraphicsLayer();
            graphicsLayer_rg.id = "graphicsLayer_rg";
            graphicsLayer_rg.visible = false;
            newGisObject.addNewLayer('Point',graphicsLayer_rg);
            graphicsLayer_rg.on("mouse-over",function(e){
                sztooltip(e,"rg");
            });

            var symbol_ft = new PictureMarkerSymbol('../assets/lz_ft.png',20,20);
            var symbol_js = new PictureMarkerSymbol('../assets/spjs4.png',20,20);
            var symbol_rg = new PictureMarkerSymbol('../assets/slsz_rg.png',20,20);
            for(var i=0;i<test_lz.length;i++){
                var targetData = test_lz[i];
                var p = new Point(targetData.LGTD,targetData.LTTD);
                var gra ;
                switch(i%3){
                    case 0:gra = new Graphic(p,symbol_ft,targetData);graphicsLayer_ft.add(gra);break;
                    case 1:gra = new Graphic(p,symbol_js,targetData);graphicsLayer_js.add(gra);break;
                    case 2:gra = new Graphic(p,symbol_rg,targetData);graphicsLayer_rg.add(gra);break;
                    default :;
                }
            }
        });
}
function rchange(type){
    if(type == "zdxcz"){
        graphicsLayer_ft.show();
        graphicsLayer_js.show();
        graphicsLayer_rg.hide();
    }else if(type == "rgxcz"){
        graphicsLayer_rg.show();
        graphicsLayer_ft.hide();
        graphicsLayer_js.hide();
    }
}
function sztooltip(e,type){
    $(tempNode).popover('destroy');
            $('.popover').remove();
    var tempNode = e.graphic.getNode();
    var popContent = '';
    popContent += '<div class=" widget-container-col ui-sortable" id="widget-container" >'
    popContent += '<div class="widget-box ui-sortable-handle" id="widget-box-5" style="margin-bottom:0px;">'
    popContent += '<div class="widget-header" style="height:30px">'
    popContent += '<h5 class="widget-title smaller">'+e.graphic.attributes.STNM+'</h5>'

    popContent += '<div class="widget-toolbar">'
    popContent += '<a href="#" id="popup_close">'
    popContent += '<i class="ace-icon fa fa-times"></i>'
    popContent += '</a>'

    popContent += '</div>'
    popContent += '</div>'

    popContent += '<div class="widget-body">'
    popContent += '<div class="widget-main padding-6">'
    popContent += '<div id="lzPopoverContent"></div>'
    // popContent += getInsideContent(e.graphic.attributes);

    popContent += '</div>'
    popContent += '</div>'
    popContent += '</div>'
    popContent += '</div>'
    // popContent = popContent + '<font style="color:#66b4dc;font-size:12px">点击测站显示详细信息'+ '</font><br>';
    var template = '<div class="popover" role="tooltip" style="z-index:5;opacity:0.9;max-width:1000px;"><div class="arrow"></div><div class="popover-content" style="font-size:10.5px;padding:0px 0px 0px 0px;margin-top:-4px;"></div></div>';
    $(tempNode).popover({
        html:true,
        placement:"auto",
        template:template,
        content:popContent,
        container:'body'});
    $(tempNode).popover('show');

    $('#popup_close').on('click',function(e){
        $(tempNode).popover('destroy');
            $('.popover').remove();
    });
    if(type == "ft"){
        popoverContent = new Vue({
            el:'#lzPopoverContent',
            template:'<popoverContent :echarts="echarts"></popoverContent>',
            components:{'popoverContent':window.vCompoment.lz_content_ft,},
            method:{

            },
            data:{
                'echarts':echarts,
            }
        });
    }else if(type == "js"){
        popoverContent = new Vue({
            el:'#lzPopoverContent',
            template:'<popoverContent :echarts="echarts"></popoverContent>',
            components:{'popoverContent':window.vCompoment.lz_content_js,},
            method:{

            },
            data:{
                
            }
        });
    }else if(type == "rg"){
        popoverContent = new Vue({
            el:'#lzPopoverContent',
            template:'<popoverContent></popoverContent>',
            components:{'popoverContent':window.vCompoment.lz_content_rg,},
            method:{

            },
            data:{
                
            }
        });
    }
    
}
</script>
